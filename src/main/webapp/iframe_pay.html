<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/loadcss.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>

<form class="layui-form">
    <div class="layui-form-item">
        <p class="show" style="text-align: center;">入住成功</p>
        <p class="show" style="text-align: center;">请支付</p>
        <label class="layui-form-label">支付方式:</label>
        <div class="layui-input-block">
            <input type="radio" name="payType" lay-filter="payType" value="cash" title="现金" checked>
            <input type="radio" name="payType" lay-filter="payType" value="cart" title="刷卡">
            <input type="radio" name="payType" lay-filter="payType" value="wechat" title="微信">
            <input type="radio" name="payType" lay-filter="payType" value="alipay" title="支付宝">
            <!--<input type="hidden" name="payType" lay-filter="payType" value="5" title="积分支付">-->
            <input type="radio" name="payType" lay-filter="payType" value="stored" title="储值支付">

        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">应付金额:</label>
        <div class="layui-input-inline">
            <input type="number" name="deposit" id="deposit" autocomplete="off" readonly class="layui-input">

        </div>
        <div class="layui-form-mid layui-word-aux">元</div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">实付金额:</label>
        <div class="layui-input-inline">
            <input type="number" required lay-verify="required" name="money" id="money" autocomplete="off"
                   class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">元</div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">付款人:</label>
        <div class="layui-input-inline">
            <select name="chilId" lay-filter="drawee" id="drawee"></select>
        </div>
    </div>
    <div class="layui-input-block" style="position: fixed; right: 10px; bottom: 10px;">

        <button class="layui-btn layui-btn-sm" lay-submit="" lay-filter="formData" data-id="1">支付</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-primary" id="back">取消</button>
    </div>
</form>
<script src="js/loadjs.js" type="text/javascript" charset="utf-8"></script>

<script>
    var _str_, money, chilId, payBO, s = '', _p, _pay_index = 0;
    layui.use(['form', 'jquery'], function () {
        var form = layui.form, $ = layui.$, id = 0;

        $('#back').on('click', function () {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
        });

        $(function () {


            $.ajax({
                data: {
                    orderId:getUrl('orderId')
                },
                type: "POST",
                dataType: "JSON",
                url: '/order/getPayInfo',
                success: function (rs) {
                    console.log(rs.data)
                    $("#deposit").val(getUrl('totalPrice'))
                    setSelectData(rs.data)
                }

            })

            // setSelectData(payBO);
            // $("#deposit").val(v)
        });

        /**
         * 绑定下拉框数据
         * @param three
         */
        function setSelectData(three) {
            for (var i = 0, len = three.length; i < len; i++) {
                $('#drawee').append("<option value=" + three[i].id + ">" + three[i].name + "</option>");
            }
            form.render('select');
        }
        //查询积分和储值余额
        form.on('radio', function(data){
            if(data.value==6||data.value==7){
                var index = layer.load(1,{time:10*1000});
                var certificateId = getUrl("certificateId");
                $.ajax({
                    data: {credentialNumber:certificateId},
                    type: "POST",
                    dataType: "JSON",
                    url: "/checkin/queryStoreValue",
                    complete: function () {
                        layer.close(index);
                    },
                    success: function (rs) {
                        layer.close(index);
                        if(!rs.success){
                            layer.alert(rs.errMsg)
                            return false;
                        }
                        if(data.value==6){
                            layer.alert("积分余额： "+ rs.data.integral+"<br>可抵现金： "+rs.data.integValue +" 元")
                        }
                        if(data.value==7){
                            layer.alert("储值余额: "+ rs.data.streValue +" 元")
                        }

                    }
                });
            }
        });
        //监听查询按钮提交
        form.on('submit(formData)', function (data) {
            data.field.id =  data.field.chilId;
            data.field.name = $("#drawee").find("option:selected").text();
            console.log(data.field)
            // return false;

                var index = layer.load(1, {time: 10 * 1000});
                $.ajax({
                    data: data.field,
                    type: "POST",
                    dataType: "JSON",
                    url: api.cashPay,
                    beforeSend: function () {
                        $("#btnSave").addClass('layui-btn-disabled');
                    },
                    complete: function () {
                        layer.close(index);
                        $("#btnSave").removeClass('layui-btn-disabled');
                    },
                    success: function (rs) {
                        layer.close(index);
                        if (!rs.success) {
                            showMsg(rs.errMsg, 2, false);
                           //  layer.msg(data.errMsg);
                            return false;
                        }
                        if (rs.success) {
                            alert("支付成功了")
                            return false;

                        }
                    }
                });

            return false;
        });

    });




</script>
</body>
</html>